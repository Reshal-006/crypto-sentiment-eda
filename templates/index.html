<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Sentiment EDA Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header / top bar -->
        <header class="topbar">
            <div class="brand">
                <div class="brand-icon">üìä</div>
                <div class="brand-text">
                    <h1>Crypto Intelligence Desk</h1>
                    <p>Price, sentiment, and volatility insights for selected assets</p>
                </div>
            </div>
            <div class="top-actions">
                <div class="action-group">
                    <button class="chip live">Live</button>
                    <button class="chip neutral" onclick="resetToDefaults()">Reset</button>
                </div>
                <label class="theme-toggle" aria-label="Toggle theme">
                    <input type="checkbox" id="themeSwitch" onchange="toggleTheme(event)">
                    <span class="switch"></span>
                    <span class="theme-label">Theme</span>
                </label>
            </div>
        </header>

        <!-- Asset selection -->
        <section class="crypto-selector">
            <h3>Select Cryptocurrencies</h3>
            <div class="crypto-options">
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="BTC-USD" checked> Bitcoin (BTC)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="ETH-USD" checked> Ethereum (ETH)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="SOL-USD"> Solana (SOL)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="BNB-USD"> Binance Coin (BNB)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="XRP-USD"> Ripple (XRP)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="ADA-USD"> Cardano (ADA)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="DOGE-USD"> Dogecoin (DOGE)
                </label>
                <label class="crypto-checkbox">
                    <input type="checkbox" name="crypto" value="MATIC-USD"> Polygon (MATIC)
                </label>
            </div>
        </section>

        <!-- Date range selection -->
        <section class="date-selector">
            <h3>Select Date Range</h3>
            <div class="date-inputs">
                <div class="date-group">
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate" name="startDate">
                </div>
                <div class="date-group">
                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate" name="endDate">
                </div>
                <button class="btn-fetch" onclick="fetchDataAndUpdate()">Fetch Data</button>
                <button class="btn-reset" onclick="resetToDefaults()">Reset</button>
            </div>
            <div id="loadingMessage" class="loading-message" style="display: none;">
                <span class="spinner"></span> Fetching data, please wait...
            </div>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </section>

        <!-- Summary cards -->
        <section class="summary-cards" id="summaryCards">
            <div class="loading">Loading summary data...</div>
        </section>

        <!-- Tabs -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="showTab('overview')">Overview</button>
            <button class="tab-btn" onclick="showTab('analysis')">Analysis</button>
            <button class="tab-btn" onclick="showTab('data')">Data</button>
        </nav>

        <!-- Tab content -->
        <div id="overview" class="tab-content active">
            <!-- Time Series Chart -->
            <section class="chart-section">
                <h2>Price & Sentiment Time Series</h2>
                <canvas id="timeseriesChart"></canvas>
            </section>

            <!-- Sentiment Distribution -->
            <section class="chart-section">
                <h2>Sentiment Distribution</h2>
                <div id="sentimentDistChart" class="chart-image">
                    <img id="sentimentDistImg" src="" alt="Sentiment Distribution">
                </div>
            </section>

            <!-- Sentiment Regimes -->
            <section class="chart-section">
                <h2>Market Sentiment Regimes</h2>
                <div id="sentimentRegimesChart" class="chart-image">
                    <img id="sentimentRegimesImg" src="" alt="Sentiment Regimes">
                </div>
            </section>
        </div>

        <div id="analysis" class="tab-content">
            <!-- Price Distributions (dynamic per selected asset) -->
            <section class="chart-section">
                <h2>Price Distributions</h2>
                <div id="priceDistributions" class="chart-row"></div>
            </section>

            <!-- Returns vs Sentiment -->
            <section class="chart-section">
                <h2>Daily Returns vs Sentiment</h2>
                <div id="returnsVsSentimentChart" class="chart-image">
                    <img id="returnsVsSentimentImg" src="" alt="Returns vs Sentiment">
                </div>
            </section>

            <!-- Volatility -->
            <section class="chart-section">
                <h2>Rolling 30-Day Volatility</h2>
                <div id="volatilityChart" class="chart-image">
                    <img id="volatilityImg" src="" alt="Volatility">
                </div>
            </section>

            <!-- Correlation Matrix -->
            <section class="chart-section">
                <h2>Correlation Analysis</h2>
                <div id="correlationChart" class="chart-image">
                    <img id="correlationImg" src="" alt="Correlation Matrix">
                </div>
            </section>
        </div>

        <div id="data" class="tab-content">
            <!-- Latest Data Table -->
            <section class="table-section">
                <div class="table-controls">
                    <h2>Data Table</h2>
                    <div class="table-filter">
                        <div class="filter-group">
                            <label for="rowCount">Rows:</label>
                            <select id="rowCount" onchange="updateTableData()">
                                <option value="10">Last 10</option>
                                <option value="20">Last 20</option>
                                <option value="50">Last 50</option>
                                <option value="100">Last 100</option>
                                <option value="all">All Data</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="tableStartDate">From:</label>
                            <input type="date" id="tableStartDate" onchange="updateTableData()">
                        </div>
                        <div class="filter-group">
                            <label for="tableEndDate">To:</label>
                            <input type="date" id="tableEndDate" onchange="updateTableData()">
                        </div>
                        <button class="chip neutral" onclick="resetTableFilters()">Reset Filters</button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table id="dataTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody">
                            <tr><td colspan="7" class="loading">Loading data...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination-controls" id="paginationControls" style="display: none;">
                    <button class="pagination-btn" id="prevPage" onclick="previousPage()" disabled>
                        ‚Üê Previous
                    </button>
                    <span class="pagination-info" id="pageInfo">Page 1 of 1</span>
                    <button class="pagination-btn" id="nextPage" onclick="nextPage()" disabled>
                        Next ‚Üí
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}?v={{ cache_bust }}"></script>
</body>
</html>
